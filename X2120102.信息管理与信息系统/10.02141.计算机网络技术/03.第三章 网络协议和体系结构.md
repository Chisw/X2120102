# 第三章 网络协议和体系结构

## 第一节 网络协议和体系结构概述

### 一、网络协议的概念

从硬件来看，只要有终端、信道和交换设备，就能使两个用户建立起连接，但要实现信息交换是不够的，需要制定规定

双方必须遵守的规则和约定称为协议或规程

包括：

1. 语法：如何讲，确定数据格式、数据码型、信号电平
2. 语义：讲什么，确定协议元素的类型，发出的控制信息、执行的返回动作、返回的应答
3. 时序关系：规定执行的顺序，确定通信状态的变化、正确的应答

### 二、分层的思想

从底层信号到完整数据分组中，技术复杂、涉及广泛，很难在一个协议中全部完成

将复杂功能由若干协议分别完成，再将其按一定方式组织起来，最典型的采用**分层方式**

核心思路：上层的功能建立在下层功能基础上，每层遵守一定的通信规则

优势：

1. 各层次之间可相互独立
- 高层无须了解底层的工作机制、使用设备和技术细节，需要低层通过接口提供哪些服务
- 每层的功能、任务清晰明确，且相对独立

2. 较强灵活性，便于实现和维护
- 整体规划、设计需要考虑十分周到
- 层次划分后，被分解成若干更容易处理的部分
- 单个领域更易发展，变化后也不会影响其他层

3. 有利于标准化
- 界定后可围绕确定的功能和服务制定相应的标准

### 三、网络体系结构

层次和协议的集合构成了网络的体系结构

其研究的是网络系统各部分的组成及其相互关系

完整的体系结构应该包括整个计算机网络的逻辑组成和功能分配，定义和描述了用于计算机及其通信设施之间互联的标准和规范的集合，以便在统一的原则指导下进行计算机网络的设计、构造、使用和维护

一种体系结构应当具有足够的信息，以允许软件设计人员给每个层次编写实现该层协议的有关程序，即通信软件，

- 1960s IBM SNA Systems Network Architecture
- DEC DNA Digital Network Architecture

目前典型的层次化体系结构有 OSI、TCP/IP

## 第二节 OSI 参考模型

1984 ISO 吸取 SNA 及其他网络体系结构，提出了开放系统互连 OSI (Open System Interconnection) 参考模型 (OSI/RM)，简称 OSI 模型

所谓开放、指按照这个标准设计和建成的数据通信网中的设备都可以互相通信

### 一、OSI 参考模型各层的功能

采用分层结构化技术分为 7 层，上 4 层：结点到结点层，下 3 层：端到端层

上 4 层主要完成信息处理服务功能，称为网络高层

下 3 层主要完成数据交换和数据传输，称为网络低层，即通信子网

低层与高层之间由第 4 传输层街接

中间系统（比如路由器）通常只实现下 3 层，物理层端到端通信：实通信

```
应用层
  |
表示层
  |
会话层
  |
传输(运输)层
  |
网络层
  |
数据链路层
  |
物理层
```

1. 物理层
- 在传输介质上实现无结构比特流传输
- 不关心实际内容，只关心如何将 0、1 以合适信号传送
- 需要实现信号编码功能
- 规定数据终端设备(DTE)、通信设备(DCE)间的接口，包括机四个方面：
  - 机械：物理特性，接口的形状、尺寸、插脚、排列方式
  - 电气：电路特性，电平大小、接收器发送器电路特性、信号识别、最大传输速率
  - 功能：各信号线用途，功能分类
  - 规程：指明传输全程及事件发生的顺序、传输方式
- 典型的有：RS-232、RS-449

2. 数据链路层
- 主要是在相邻结点间传输数据
- 物理传输难免出错，为实现差错控制，采用“帧”为单位的数据块传输方式
- 需要相应的帧同步技术，数据链路层的“成帧（帧同步）”，包括
  - 定义帧的格式、类型、成帧方法
- 功能：
  - 数据吗附加循环码实现链路层差错控制
  - 实现相邻结点间的流量控制
  - 链路管理
  - **寻址**：确保每帧准确传送到正确处，接收方也应该知道发送方的地址，在广播介质网络中尤为重要，比如局域网中广泛采用 MAC 地址

3. 网络层
- 解决如何将分组通过交换网络传送至目的主机
- 主要功能是数据转发、路由
- 源结点、中继结点、目的结点构成了路径
- 结点间有多条路径可选，此路由选择是网络层的要完成主要功能之一
- 还要控制通信量，避免网络性能下降
- 与链路层类似，也具备寻址功能，确保分组正确传输，比如 IP 地址

4. 传输层
- 是第一个端到端的层次，也是进程-进程层次
- 数据通信表面是在两台主机间进行，实质上是在两个主机的进程之间
- 物理、链路、网络三层可组成公共网络，被多设备共享，且计算机-结点机、结点机-结点机是按照“接力〞方式传送
- 为了防止传送途中报文的丢失，两个主机的进程之间需要实现端到端控制
- 传输层的功能主要包括复用/解复用（区分发送和接收主机上的进程）、端到端的可靠数据传输、连接控制、流量控制和拥塞控制机制等

5. 会话层
- 指用户间连接，通过两台计算机间建立、管理和终止通信来完成对话
- 主要功能：
  - 建立会话时核实双方身份是否有权参加会话
  - 确定何方支付通信费用
  - 双方在各种选择功能方面（如全双工还是半双工通信）取得一致
  - 在会话建立以后，需要对进程问的对话进行管理与控制
- 实际中，会话层的功能已经被应用层覆盖，很少单独存在

6. 表示层
- 主要处理应用实体间交换数据的语法，解决格式和数据表示的差别
- 为应用层提供一致的数据格式，从而使字符、格式等有差异的设备之间相互通信
- 还可实现文本压缩、解压缩，数据加密、解密，字符编码转换
- 此层某些实际数据通讯网络中也是由应用层实现，不独立存在

7. 应用层
- 与提供给用户丰富的网络服务相关：文件传送、电子邮件和 P2P 应用等
- 应用层为用户提供了一个应用网络通信的接口

### 二、OSI 参考模型的有关术语

每层真正功能是为上层服务

1. 数据单元
- 层实体间传送的比特组称为数据单元
- 对等层间传输按本层协议进行，此时称为协议数据单元
- PDU 在不同层往往有不同的叫法
  - 物理层中：位流或比特流
  - 数据链路层中：帧
  - 网络层中：分组或包
  - 传输层中：数据段或报文段
  - 应用层中：报文

2. 服务访问点
- 邻层间服务通过接口面的服务访问点（SAP Service Access Point）进行
- 每个 SAP 有唯一地址号码

3. 服务原语
- 邻层间服务的提供、请求提供都是用一组原语（Primitive）描述的：
  - 请求 Request
  - 指示 Indication
  - 响应 Response
  - 确认 Confirm

4. 面向连接和无连接
- 分层体系结构中，下层向上层提供服务的两种形式
- 面向连接：电话系统，建立连接、发送数据
- 无连接（数据报 Datagram）：邮件发送，没有建立河拆除链路的过程

## 第三节 TCP/IP 参考模型


